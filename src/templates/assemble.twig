{%- macro assemble( data = null, name = null, args = {}, path = [] ) -%}
    {%- set path = ( path ?? [] ) | filter | values -%}
    {{- renderMacroIfExists(path, name, data, args) | raw -}}
{%- endmacro -%}


{## ----------------------------------------------------------------- ##}


{%- macro builder( data = null, name = null ) -%}
    {%- set entry = varargs.entry ?? null -%}
    {%- set type  = entry.type.handle ?? entry.type ?? varargs.type ?? null -%}
    {%- set path  = ["_base/builder", "_theme/builder", "_burton/builder"] -%}

    {%- if type is string -%}
        {%- set path = path | map(template => "#{template}.#{type}") | merge( path ) -%}
    {%- endif -%}

    {%- set params = {
        path: path,
        name: name ? ["builder__#{name}", "builder"] : "builder",
        data: data,
        args: { builder: name ?? 'body' } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro card( data = null, name = null ) -%}
    {%- set entry = varargs.entry ?? data -%}
    {%- set type  = entry.type.handle ?? entry.type ?? varargs.type ?? null -%}
    {%- set path = [
     type ? "_base/#{type}",
     type ? "_theme/#{type}",
            "_base/card",
            "_theme/card",
            "_burton/card"
    ] | filter -%}

    {%- set name = name ?? varargs.card ?? null -%}
    {%- set params = {
        path: path,
        name: ["card__#{type}", "card__#{name}", "card"],
        data: data,
        args: { card: name } | merge( varargs, true ),
    } -%}

    {{- data ?  _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro container( data = null, name = null ) -%}
    {%- set name = name ?? varargs.container ?? null -%}

    {%- set params = {
        path: ["_base/container", "_theme/container", "_burton/container" ],
        name: "container",
        data: data,
        args: { container: name } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro grid( data = null, name = null ) -%}
    {%- set name = name ?? varargs.grid ?? null -%}
    {%- set name = "grid_#{name}" -%}
    {%- set params = {
        path: ["_base/grid", "_theme/grid", "_burton/grid"],
        name: "grid",
        data: data,
        args: { grid: name } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro image( data = null, name = null ) -%}
    {%- set name = name ?? varargs.layer ?? null -%}
    {%- set name = "image__#{name}" -%}

    {%- set params = {
        path: ["_base/image", "_theme/image", "_burton/image"],
        name: name ? [name, "image"] : "image",
        data: data,
        args: { layer: name } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro layout( data = null, name = null ) -%}
    {%- set name  = name ?? varargs.layout ?? null -%}
    {%- set path  = ["_base/partial","_theme/partial", "_burton/partial"] -%}
    {%- set names = ["layout"] -%}

    {%- if name is iterable and name[0] is string -%}
        {%- set path = [name[1] ?? null] | merge(path) | filter -%}
        {%- set name = name[0] -%}
        {%- set names = names|unshift(name) -%}
    {%- endif -%}

    {%- if name is string -%}
        {%- set names = names|unshift("layout__#{name}") -%}
    {%- endif -%}

    {%- set params = {
        path: path,
        name: names,
        data: data,
        args: { layout: name } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro media( data = null, name = null ) -%}
    {%- set name = name ?? varargs.player ?? null -%}
    {%- set name = "media_#{name}" -%}

    {%- set params = {
        path: ["_base/media", "_theme/media", "_burton/media"],
        name: name ? [name, "media"] : "media",
        data: data,
        args: { player: name } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro menu( data = null, name = null ) -%}
    {%- set name = name ?? varargs.format ?? ( data is string ? data : null ) -%}
    {%- set params = {
        path: ["_base/menu", "_theme/menu", "_burton/menu"],
        name: [ data is string ? "menu__#{data}", name is string ? "menu__#{name}", "renderMenu" ],
        data: data,
        args: { format: name } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro zonelayout( data = null, name = null ) -%}
    {%- set name = name ?? varargs.zonelayout ?? null -%}

    {%- set params = {
        path: ["_base/zones", "_theme/zones", "_burton/zones"],
        name: "zonelayout",
        data: data,
        args: { zonelayout: name } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro search( data = null, name = null ) -%}
    {%- set params = {
        path: ["_base/search", "_theme/search", "_burton/search"],
        name: name ? name : "search",
        data: data,
        args: { interface: name } | merge( varargs, true ),
    } -%}
    {{- _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro sep( data = null, name = null ) -%}
    {%- set name = name ?? varargs.separator ?? ( data is string ? data : null ) -%}
    {%- set params = {
        path: ["_base/separator", "_theme/separator", "_burton/separator"],
        name: "separator",
        data: data,
        args: { separator: name } | merge( varargs, true )
    } -%}
    {{- _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro text( data = null, name = null ) -%}
    {%- set params = {
        path: ["_base/text", "_theme/text", "_burton/text"],
        name: [ "text__#{name}", "text"],
        data: data,
        args: { format: name } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro theme( data = null, name = null ) -%}
    {%- set params = {
        path: ["_base/group", "_theme/group", "_burton/group"],
        name: [ "theme__#{name}", "theme" ],
        data: data,
        args: { theme: name } | merge( varargs, true )
    } -%}
    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}