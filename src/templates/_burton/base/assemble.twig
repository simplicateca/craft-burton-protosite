{%- macro assemble( data = null, name = null, args = {}, path = [] ) -%}
    {%- set path = ( path ?? [] ) | filter | values -%}
    {{- renderMacroIfExists(path, name, data, args) | raw -}}
{%- endmacro -%}


{## ----------------------------------------------------------------- ##}


{%- macro builder( data = null, name = null ) -%}
    {%- set entry = varargs.entry ?? null -%}
    {%- set type  = entry.type.handle ?? entry.type ?? varargs.type ?? null -%}
    {%- set path  = ["_burton/local/builder", "_burton/theme/builder", "_burton/base/builder"] -%}

    {%- if type is string -%}
        {%- set path = path | map(template => "#{template}.#{type}") | merge( path ) -%}
    {%- endif -%}

    {%- set params = {
        path: path,
        name: name ? ["builder__#{name}", "builder"] : "builder",
        data: data,
        args: { builder: name ?? 'body' } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro card( data = null, name = null ) -%}
    {%- set entry = varargs.entry ?? data -%}
    {%- set type  = entry.type.handle ?? entry.type ?? varargs.type ?? null -%}
    {%- set path = [
     type ? "_burton/local/#{type}",
     type ? "_burton/theme/#{type}",
            "_burton/local/card",
            "_burton/theme/card",
            "_burton/base/card"
    ] | filter -%}

    {%- set name = name ?? varargs.card ?? null -%}
    {%- set params = {
        path: path,
        name: ["card__#{type}", "card__#{name}", "card"],
        data: data,
        args: { card: name } | merge( varargs, true ),
    } -%}

    {{- data ?  _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro container( data = null, name = null ) -%}
    {%- set name = name ?? varargs.container ?? null -%}

    {%- set params = {
        path: ["_burton/local/container", "_burton/theme/container", "_burton/base/container" ],
        name: "container",
        data: data,
        args: { container: name } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro grid( data = null, name = null ) -%}
    {%- set name = name ?? varargs.grid ?? null -%}
    {%- set name = "grid_#{name}" -%}
    {%- set params = {
        path: ["_burton/local/grid", "_burton/theme/grid", "_burton/base/grid"],
        name: "grid",
        data: data,
        args: { grid: name } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro image( data = null, name = null ) -%}
    {%- set name = name ?? varargs.layer ?? null -%}
    {%- set name = "image__#{name}" -%}

    {%- set params = {
        path: ["_burton/local/image", "_burton/theme/image", "_burton/base/image"],
        name: name ? [name, "image"] : "image",
        data: data,
        args: { layer: name } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro layout( data = null, name = null ) -%}
    {%- set name  = name ?? varargs.layout ?? null -%}
    {%- set path  = ["_burton/local/partial","_burton/theme/partial", "_burton/base/partial"] -%}
    {%- set names = ["layout"] -%}

    {%- if name is iterable and name[0] is string -%}
        {%- set path = [name[1] ?? null] | merge(path) | filter -%}
        {%- set name = name[0] -%}
        {%- set names = names|unshift(name) -%}
    {%- endif -%}

    {%- if name is string -%}
        {%- set names = names|unshift("layout__#{name}") -%}
    {%- endif -%}

    {%- set params = {
        path: path,
        name: names,
        data: data,
        args: { layout: name } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro media( data = null, name = null ) -%}
    {%- set name = name ?? varargs.player ?? null -%}
    {%- set name = "media_#{name}" -%}

    {%- set params = {
        path: ["_burton/local/media", "_burton/theme/media", "_burton/base/media"],
        name: name ? [name, "media"] : "media",
        data: data,
        args: { player: name } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro menu( data = null, name = null ) -%}
    {%- set name = name ?? varargs.format ?? ( data is string ? data : null ) -%}
    {%- set params = {
        path: ["_burton/local/menu", "_burton/theme/menu", "_burton/base/menu"],
        name: [ data is string ? "menu__#{data}", name is string ? "menu__#{name}", "renderMenu" ],
        data: data,
        args: { format: name } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro zonelayout( data = null, name = null ) -%}
    {%- set name = name ?? varargs.zonelayout ?? null -%}

    {%- set params = {
        path: ["_burton/local/zones", "_burton/theme/zones", "_burton/base/zones"],
        name: "zonelayout",
        data: data,
        args: { zonelayout: name } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro search( data = null, name = null ) -%}
    {%- set params = {
        path: ["_burton/local/search", "_burton/theme/search", "_burton/base/search"],
        name: name ? name : "search",
        data: data,
        args: { interface: name } | merge( varargs, true ),
    } -%}
    {{- _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro sep( data = null, name = null ) -%}
    {%- set name = name ?? varargs.separator ?? ( data is string ? data : null ) -%}
    {%- set params = {
        path: ["_burton/local/separator", "_burton/theme/separator", "_burton/base/separator"],
        name: "separator",
        data: data,
        args: { separator: name } | merge( varargs, true )
    } -%}
    {{- _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro text( data = null, name = null ) -%}
    {%- set params = {
        path: ["_burton/local/text", "_burton/theme/text", "_burton/base/text"],
        name: [ "text__#{name}", "text"],
        data: data,
        args: { format: name } | merge( varargs, true ),
    } -%}

    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}


{%- macro theme( data = null, name = null ) -%}
    {%- set params = {
        path: ["_burton/local/group", "_burton/theme/group", "_burton/base/group"],
        name: [ "theme__#{name}", "theme" ],
        data: data,
        args: { theme: name } | merge( varargs, true )
    } -%}
    {{- data ? _self.assemble( ...params ) -}}
{%- endmacro -%}
